(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5243],{4662:function(e,t,s){Promise.resolve().then(s.bind(s,6029))},6029:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return P}});var n=s(7821),r=s(8078),a=s(8504),i=s(9926),c=s(1392),l=s(9008),o=s(6066),d=s(4852),u=s(3842),m=s(8006),x=s(2547),f=s(5813),h=s(8620),y=s(2133),p=s(2531),g=s(9230),j=s(6567);function N(e){let{onSuccess:t,amount:s}=e,a=(0,g.MD)(),i=(0,g.lq)(),[c,l]=(0,r.useState)(!1),[o,m]=(0,r.useState)(null),[h,y]=(0,r.useState)(!1),j=async e=>{if(e.preventDefault(),!a||!i)return;l(!0),m(null);let{error:s}=await i.submit();if(s){m(s.message||"An error occurred during payment processing."),l(!1);return}let{error:n}=await a.confirmPayment({elements:i,confirmParams:{return_url:"".concat(window.location.origin,"/dashboard/my-bookings")},redirect:"if_required"});n?(m(n.message||"Payment failed. Please try again."),l(!1)):(y(!0),l(!1),setTimeout(()=>{t()},2e3))};return h?(0,n.jsxs)("div",{className:"text-center py-8",children:[(0,n.jsx)(p.Z,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Payment Successful!"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Your booking has been confirmed and payment processed successfully."})]}):(0,n.jsxs)("form",{onSubmit:j,className:"space-y-6",children:[(0,n.jsx)("div",{className:"space-y-4",children:(0,n.jsx)(g.Hn,{options:{layout:"tabs"}})}),o&&(0,n.jsxs)(x.bZ,{variant:"destructive",children:[(0,n.jsx)(f.Z,{className:"h-4 w-4"}),(0,n.jsx)(x.X,{children:o})]}),(0,n.jsx)(u.z,{type:"submit",disabled:!a||c,className:"w-full",size:"lg",children:c?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d.T,{size:"sm",className:"mr-2"}),"Processing Payment..."]}):"Pay $".concat(s.toFixed(2))}),(0,n.jsx)("p",{className:"text-xs text-gray-500 text-center",children:"By completing this payment, you agree to our terms of service and payment policies."})]})}var b=s(2949);let v=(0,j.J)(b.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY);function w(){let{bookingId:e}=(0,a.useParams)(),{user:t}=(0,i.a)(),s=(0,a.useRouter)(),[o,j]=(0,r.useState)(""),[b,w]=(0,r.useState)(null),P=(0,c.aS)();return((0,r.useEffect)(()=>{(async()=>{if(e&&"string"==typeof e)try{let t=await P.mutateAsync(e);j(t.clientSecret),w(t)}catch(e){console.error("Failed to create payment intent:",e)}})()},[e]),(null==t?void 0:t.role)!==l.UserRole.OWNER)?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDEAB"}),(0,n.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),(0,n.jsx)("p",{className:"text-gray-600 mb-6",children:"Only pet owners can make payments for bookings."}),(0,n.jsx)(u.z,{onClick:()=>s.push("/dashboard/my-bookings"),children:"Back to My Bookings"})]})}):P.isPending?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(d.T,{size:"lg",className:"mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Preparing payment..."})]})}):P.error?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center max-w-md",children:[(0,n.jsx)(f.Z,{className:"mx-auto h-12 w-12 text-red-500 mb-4"}),(0,n.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Payment Setup Failed"}),(0,n.jsx)("p",{className:"text-gray-600 mb-6",children:P.error instanceof Error?P.error.message:"Failed to setup payment. Please try again."}),(0,n.jsx)(u.z,{onClick:()=>s.push("/dashboard/my-bookings"),children:"Back to My Bookings"})]})}):o&&b?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,n.jsxs)("div",{className:"max-w-2xl mx-auto px-4",children:[(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsxs)(u.z,{variant:"ghost",onClick:()=>s.push("/dashboard/my-bookings"),className:"mb-4",children:[(0,n.jsx)(h.Z,{className:"mr-2 h-4 w-4"}),"Back to My Bookings"]}),(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Complete Payment"}),(0,n.jsx)("p",{className:"text-gray-600 mt-2",children:"Secure payment processing powered by Stripe"})]}),(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)(m.Zb,{children:[(0,n.jsxs)(m.Ol,{children:[(0,n.jsxs)(m.ll,{className:"flex items-center gap-2",children:[(0,n.jsx)(y.Z,{className:"h-5 w-5"}),"Payment Summary"]}),(0,n.jsx)(m.SZ,{children:"Review your booking details before completing payment"})]}),(0,n.jsx)(m.aY,{children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center py-2",children:[(0,n.jsx)("span",{className:"text-sm font-medium",children:"Service Amount"}),(0,n.jsxs)("span",{className:"text-sm",children:["$",b.amount.toFixed(2)]})]}),(0,n.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,n.jsx)("span",{className:"text-sm font-medium",children:"Platform Fee (10%)"}),(0,n.jsxs)("span",{className:"text-sm text-gray-600",children:["$",b.platformFee.toFixed(2)]})]}),(0,n.jsxs)("div",{className:"flex justify-between items-center py-2 text-lg font-semibold",children:[(0,n.jsx)("span",{children:"Total Amount"}),(0,n.jsxs)("span",{children:["$",b.amount.toFixed(2)]})]})]})})]}),(0,n.jsxs)(m.Zb,{children:[(0,n.jsxs)(m.Ol,{children:[(0,n.jsx)(m.ll,{children:"Payment Information"}),(0,n.jsx)(m.SZ,{children:"Your payment information is secure and encrypted"})]}),(0,n.jsx)(m.aY,{children:(0,n.jsx)(g.eK,{options:{clientSecret:o,appearance:{theme:"stripe"}},stripe:v,children:(0,n.jsx)(N,{onSuccess:()=>{s.push("/dashboard/my-bookings")},amount:b.amount})})})]}),(0,n.jsxs)(x.bZ,{children:[(0,n.jsx)(p.Z,{className:"h-4 w-4"}),(0,n.jsx)(x.X,{children:"Your payment is secured by Stripe's industry-leading security measures. We do not store your payment information on our servers."})]})]})]})}):(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,n.jsx)(d.T,{size:"lg"})})}function P(){return(0,n.jsx)(o.i,{children:(0,n.jsx)(w,{})})}},4852:function(e,t,s){"use strict";s.d(t,{T:function(){return r}});var n=s(7821);function r(e){let{size:t="md",className:s=""}=e;return(0,n.jsx)("div",{className:"flex justify-center items-center ".concat(s),children:(0,n.jsx)("div",{className:"".concat({sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"}[t]," border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin")})})}s(8078)},6066:function(e,t,s){"use strict";s.d(t,{i:function(){return i}});var n=s(7821),r=s(8078),a=s(9926);function i(e){let{children:t}=e,{isAuthenticated:s,isLoading:i}=(0,a.a)();return(console.log("[ProtectedRoute DEBUG] Render - isAuthenticated:",s,"isLoading:",i),(0,r.useEffect)(()=>{console.log("[ProtectedRoute DEBUG] useEffect triggered - isLoading:",i,"isAuthenticated:",s),i||s?!i&&s&&console.log("[ProtectedRoute DEBUG] User is authenticated, allowing access"):(console.log("[ProtectedRoute DEBUG] Not authenticated, redirecting to /login"),window.location.href="/login")},[s,i]),i)?(console.log("[ProtectedRoute DEBUG] Still loading, showing loading spinner"),(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})})):s?(console.log("[ProtectedRoute DEBUG] Rendering protected content"),(0,n.jsx)(n.Fragment,{children:t})):(console.log("[ProtectedRoute DEBUG] Not authenticated, returning null"),null)}},2547:function(e,t,s){"use strict";s.d(t,{X:function(){return o},bZ:function(){return l}});var n=s(7821),r=s(8078),a=s(898),i=s(7211);let c=(0,a.j)("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),l=r.forwardRef((e,t)=>{let{className:s,variant:r,...a}=e;return(0,n.jsx)("div",{ref:t,role:"alert",className:(0,i.cn)(c({variant:r}),s),...a})});l.displayName="Alert",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)("h5",{ref:t,className:(0,i.cn)("mb-1 font-medium leading-none tracking-tight",s),...r})}).displayName="AlertTitle";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,i.cn)("text-sm [&_p]:leading-relaxed",s),...r})});o.displayName="AlertDescription"},8006:function(e,t,s){"use strict";s.d(t,{Ol:function(){return c},SZ:function(){return o},Zb:function(){return i},aY:function(){return d},eW:function(){return u},ll:function(){return l}});var n=s(7821),r=s(8078),a=s(7211);let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("rounded-xl border bg-card text-card-foreground shadow",s),...r})});i.displayName="Card";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",s),...r})});c.displayName="CardHeader";let l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("font-semibold leading-none tracking-tight",s),...r})});l.displayName="CardTitle";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",s),...r})});o.displayName="CardDescription";let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",s),...r})});d.displayName="CardContent";let u=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",s),...r})});u.displayName="CardFooter"},1392:function(e,t,s){"use strict";s.d(t,{B9:function(){return c},Wd:function(){return l},aS:function(){return o}});var n=s(5427),r=s(8191),a=s(8683),i=s(6963);function c(){return(0,n.a)({queryKey:["stripe","account-status"],queryFn:async()=>(await i.hi.get("/stripe/connect/account-status")).data,enabled:!0})}function l(){let e=(0,r.NL)();return(0,a.D)({mutationFn:async()=>(await i.hi.post("/stripe/connect/onboard")).data.data,onSuccess:()=>{e.invalidateQueries({queryKey:["stripe","account-status"]})}})}function o(){return(0,a.D)({mutationFn:async e=>(await i.hi.post("/bookings/".concat(e,"/create-payment-intent"))).data.data})}}},function(e){e.O(0,[8803,5427,9808,484,6518,7115,2364,1744],function(){return e(e.s=4662)}),_N_E=e.O()}]);